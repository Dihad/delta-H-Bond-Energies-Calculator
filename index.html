<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/png" href="https://dihad.github.io/Repeating-Decimal-Operations/web%20icon.jpeg">
  <title>ΔH (Bond Energies) Calculator</title>
  <style>
    :root{
      --bg:#0b0f13;
      --card:#0f1720;
      --muted:#9aa6b2;
      --accent:#7bd389;
      --danger:#ff6b6b;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent), var(--bg);
      color:#e6eef6;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .container{
      width:100%;
      max-width:980px;
      border-radius:12px;
      padding:18px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow: 0 6px 30px rgba(2,8,23,0.7);
      border:1px solid rgba(255,255,255,0.03);
    }
    header{
      display:flex;
      gap:12px;
      align-items:center;
      margin-bottom:12px;
    }
    .logo {
      width:48px;height:48px;border-radius:10px;
      display:grid;place-items:center;
      background:linear-gradient(135deg,#14323b,#0b6b4f);
      font-weight:700;color:white;
      box-shadow: 0 4px 18px rgba(13,58,49,0.4);
    }
    h1{font-size:18px;margin:0}
    p.lead{color:var(--muted);margin:0;font-size:13px}
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
      margin-top:12px;
    }
    .card{
      background:var(--card);
      border-radius:10px;
      padding:12px;
      border:1px solid rgba(255,255,255,0.02);
    }
    label{display:block;color:var(--muted);font-size:13px;margin-bottom:8px}
    textarea{
      width:100%;min-height:110px;
      background:var(--glass);
      color:var(--muted);
      border-radius:8px;border:1px dashed rgba(255,255,255,0.03);
      padding:10px;font-family:ui-monospace, SFMono-Regular, Menlo, monospace;
      resize:vertical;font-size:14px;
    }
    .controls{display:flex;gap:10px;align-items:center;margin-top:12px;flex-wrap:wrap}
    button{
      background:linear-gradient(180deg,#11806f,#0b6650);
      color:white;padding:10px 14px;border-radius:8px;border:0;font-weight:600;
      cursor:pointer;
      box-shadow: 0 6px 18px rgba(8,90,68,0.25);
    }
    button.secondary{
      background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);
      box-shadow:none;font-weight:600;
    }
    .result{
      margin-top:14px;padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent);
      border:1px solid rgba(255,255,255,0.02);
    }
    .big{
      font-size:24px;font-weight:700;
      color:var(--accent);
    }
    .small{color:var(--muted);font-size:13px}
    .warn{color:var(--danger);font-weight:700}
    pre.break{
      margin:0;padding:10px;background:rgba(255,255,255,0.02);border-radius:8px;overflow:auto;
      color:#cfeff0;font-size:13px;
    }
    .footer{margin-top:14px;display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:13px;flex-wrap:wrap}
    .table {
      margin-top:12px;padding:12px;border-radius:8px;background:rgba(255,255,255,0.01);max-height:240px;overflow:auto;
      border:1px solid rgba(255,255,255,0.02);
    }
    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{padding:6px 8px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.02)}
    th{color:var(--muted);font-weight:600}
    td.code{font-family:ui-monospace, monospace;color:#d7f6ee}
    .hint{color:var(--muted);font-size:12px;margin-top:8px}
    @media (max-width:880px){
      .grid{grid-template-columns:1fr}
      header{gap:10px}
      .container{padding:14px}
      textarea{min-height:90px}
    }
    @media (max-width:420px){
      body{padding:12px}
      .logo{width:40px;height:40px}
      h1{font-size:16px}
      button{padding:8px 10px;font-size:14px}
    }
  </style>
</head>
<body>
  <div class="container" role="main">
    <header>
      <div class="logo">ΔH</div>
      <div>
        <h1>ΔH (Bond Energies) — Calculator</h1>
        <p class="lead">Type reactants and products like <code>2(H-H) + (O--O)</code> and <code>2(H-O-H)</code>. "-" single, "--" double, "---" triple.</p>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <label for="reactants">Reactants</label>
        <textarea id="reactants" placeholder="e.g. 2(H-H) + (O--O)"></textarea>
        <div class="hint">Use parentheses for molecules. Multipliers allowed: <code>2(...)</code>. Separate species with <code>+</code>.</div>
      </div>

      <div class="card">
        <label for="products">Products</label>
        <textarea id="products" placeholder="e.g. 2(H-O-H)"></textarea>
        <div class="hint">Example: Reactants: <code>2(H-H) + (O--O)</code> → Products: <code>2(H-O-H)</code></div>
      </div>
    </div>

    <div class="controls" style="margin-top:14px">
      <button id="calcBtn">Calculate ΔH</button>
      <button id="clearBtn" class="secondary">Clear</button>
      <div style="margin-left:auto;color:var(--muted);font-size:13px">Units: kJ/mol</div>
    </div>

    <div class="result" id="result">
      <div class="small">Result will appear here after calculating.</div>
    </div>

    <div class="card table" aria-live="polite" style="margin-top:14px">
      <strong style="display:block;margin-bottom:8px">Bond energy table (kJ/mol)</strong>
      <table>
        <thead><tr><th>Bond</th><th>Energy</th><th>Bond</th><th>Energy</th></tr></thead>
        <tbody id="bondTable"></tbody>
      </table>
      <div class="hint">If a bond in your input isn't in the table, the calculator will report it.</div>
    </div>

    <div class="footer">
      <div>Made by dihad</div>
      <div style="color:var(--muted);font-size:13px">© ΔH Calculator</div>
    </div>
  </div>

  <script>
    const rawBondData = [
      ['C','H',1,414],
      ['C','Cl',1,326],
      ['C','C',1,344],
      ['Br','Br',1,193],
      ['O','O',1,143],
      ['H','Cl',1,431],
      ['H','I',1,299],
      ['Cl','Cl',1,244],
      ['I','I',1,151],
      ['H','H',1,436],
      ['H','Br',1,366],
      ['H','F',1,563],
      ['C','O',1,350],
      ['N','H',1,391],
      ['O','H',1,464],
      ['C','C',2,615],
      ['C','O',2,724],
      ['O','O',2,498],
      ['N','N',3,946],
      ['C','C',3,812]
    ];

    const bondMap = {};
    function keyFor(a,b,order){
      const pair = [a,b].slice().sort().join('|');
      return `${pair}|${order}`;
    }
    rawBondData.forEach(([a,b,order,val])=>{
      bondMap[keyFor(a,b,order)] = val;
    });

    function buildTable(){
      const tbody = document.getElementById('bondTable');
      tbody.innerHTML = '';
      const items = [];
      Object.keys(bondMap).forEach(k=>{
        const parts = k.split('|');
        const a = parts[0];
        const b = parts[1];
        const order = parts[2];
        const bondText = `${a}${order==='1'?'-':order==='2'?'=':'≡'}${b}`;
        items.push({bond:bondText,energy:bondMap[k]});
      });
      for(let i=0;i<items.length;i+=2){
        const left = items[i];
        const right = items[i+1];
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="code">${left?left.bond:''}</td><td>${left?left.energy:''}</td><td class="code">${right?right.bond:''}</td><td>${right?right.energy:''}</td>`;
        tbody.appendChild(tr);
      }
    }
    buildTable();

    function splitByPlusTopLevel(s){
      const parts = [];
      let depth=0,buf='';
      for(let ch of s){
        if(ch==='(') depth++;
        if(ch===')') depth = Math.max(0, depth-1);
        if(ch==='+' && depth===0){
          parts.push(buf); buf=''; continue;
        }
        buf+=ch;
      }
      if(buf) parts.push(buf);
      return parts;
    }

    function parseMoleculeToBonds(str){
      const bonds = [];
      let i=0;
      const L = str.length;
      function readAtom(){
        if(i>=L) throw new Error('Unexpected end while reading atom');
        const ch = str[i];
        if(!/[A-Z]/.test(ch)) throw new Error(`Expected atom (capital letter) at position ${i+1} in "${str}"`);
        let atom = ch; i++;
        if(i < L && /[a-z]/.test(str[i])){
          atom += str[i]; i++;
        }
        return atom;
      }
      while(i < L && /\s/.test(str[i])) i++;
      let prev = readAtom();
      while(true){
        while(i < L && /\s/.test(str[i])) i++;
        if(i>=L) break;
        if(str[i] !== '-') break;
        let hcount = 0;
        while(i < L && str[i] === '-'){ hcount++; i++; }
        if(hcount < 1) throw new Error('Invalid bond notation');
        while(i < L && /\s/.test(str[i])) i++;
        const next = readAtom();
        bonds.push({a:prev,b:next,order:hcount,count:1});
        prev = next;
      }
      return bonds;
    }

    function canonicalBondKey(a,b,order){
      const pair = [a,b].slice().sort().join('|');
      return `${pair}|${order}`;
    }

    function parseSide(text){
      const result = { bonds: {}, errors: [] };
      if(!text || !text.trim()) return result;
      const parts = splitByPlusTopLevel(text);
      for(const raw of parts){
        let t = raw.trim();
        if(!t) continue;
        const multMatch = t.match(/^(\d+)\s*\((.*)\)\s*$/);
        let multiplier = 1;
        let molecule = t;
        if(multMatch){
          multiplier = parseInt(multMatch[1],10);
          molecule = multMatch[2].trim();
        } else {
          const parenMatch = t.match(/^\((.*)\)\s*$/);
          if(parenMatch){ molecule = parenMatch[1].trim(); }
          else {
            const leadingNum = t.match(/^(\d+)\s*(.+)$/);
            if(leadingNum){
              multiplier = parseInt(leadingNum[1],10);
              molecule = leadingNum[2].trim();
            } else {
              molecule = t;
            }
          }
        }
        try{
          const bondsInMolecule = parseMoleculeToBonds(molecule);
          for(const b of bondsInMolecule){
            const k = canonicalBondKey(b.a,b.b,b.order);
            result.bonds[k] = (result.bonds[k]||0) + b.count * multiplier;
          }
        }catch(e){
          result.errors.push(`Error parsing "${raw}": ${e.message || e}`);
        }
      }
      return result;
    }

    function lookupEnergyForKey(key){
      return bondMap[key] ?? null;
    }

    function computeDeltaH(reactText, prodText){
      const r = parseSide(reactText);
      const p = parseSide(prodText);
      const missing = new Set();
      let reactSum = 0;
      let prodSum = 0;
      for(const key in r.bonds){
        const energy = lookupEnergyForKey(key);
        if(energy==null) missing.add(key);
        else reactSum += energy * r.bonds[key];
      }
      for(const key in p.bonds){
        const energy = lookupEnergyForKey(key);
        if(energy==null) missing.add(key);
        else prodSum += energy * p.bonds[key];
      }
      const delta = reactSum - prodSum;
      return {
        reactSum, prodSum, delta, missing: Array.from(missing), reactParsed: r, prodParsed: p
      };
    }

    const calcBtn = document.getElementById('calcBtn');
    const clearBtn = document.getElementById('clearBtn');
    const reactTa = document.getElementById('reactants');
    const prodTa = document.getElementById('products');
    const resultDiv = document.getElementById('result');

    reactTa.value = "2(H-H) + (O--O)";
    prodTa.value  = "2(H-O-H)";

    calcBtn.addEventListener('click', ()=>{
      const rtext = reactTa.value;
      const ptext = prodTa.value;
      const out = computeDeltaH(rtext,ptext);
      const missingFriendly = out.missing.map(k=>{
        const [a,b,order] = k.split('|');
        const bondSymbol = order==='1'?'-':order==='2'?'=':'≡';
        return `${a}${bondSymbol}${b} (order ${order})`;
      });
      const html = [];
      html.push(`<div class="small">Reactant bonds total: <strong>${out.reactSum.toLocaleString()} kJ/mol</strong></div>`);
      html.push(`<div class="small">Product bonds total: <strong>${out.prodSum.toLocaleString()} kJ/mol</strong></div>`);
      const signClass = out.delta>0 ? "warn" : "big";
      html.push(`<div style="margin-top:8px" class="${signClass}">ΔH = ${out.delta>0?'+':''}${out.delta.toLocaleString()} kJ/mol</div>`);
      html.push(`<div class="small" style="margin-top:6px">Convention: ΔH = Σ(reactant bonds) − Σ(product bonds). Positive = endothermic, Negative = exothermic.</div>`);
      if(out.missing.length){
        html.push(`<hr style="border:none;height:1px;background:rgba(255,255,255,0.03);margin:10px 0">`);
        html.push(`<div class="warn">Warning: ${out.missing.length} bond type(s) not found in table. These were ignored:</div>`);
        html.push(`<pre class="break">${missingFriendly.join(", ")}</pre>`);
        html.push(`<div class="small">To include missing bonds, add them in the bond table in the code.</div>`);
      }
      html.push(`<hr style="border:none;height:1px;background:rgba(255,255,255,0.02);margin:10px 0">`);
      html.push(`<div class="small"><strong>Breakdown (bond : count)</strong></div>`);
      html.push(`<div style="display:flex;gap:12px;margin-top:8px;flex-wrap:wrap">`);
      html.push(`<div style="flex:1;min-width:220px"><div class="small">Reactants</div><pre class="break">${friendlyBondList(out.reactParsed.bonds)}</pre></div>`);
      html.push(`<div style="flex:1;min-width:220px"><div class="small">Products</div><pre class="break">${friendlyBondList(out.prodParsed.bonds)}</pre></div>`);
      html.push(`</div>`);
      resultDiv.innerHTML = html.join('');
    });

    clearBtn.addEventListener('click', ()=>{
      reactTa.value = '';
      prodTa.value = '';
      resultDiv.innerHTML = `<div class="small">Result will appear here after calculating.</div>`;
    });

    function friendlyBondList(bdict){
      const lines = [];
      for(const key in bdict){
        const [a,b,order] = key.split('|');
        const bondSymbol = order==='1'?'-':order==='2'?'=':'≡';
        lines.push(`${a}${bondSymbol}${b} : ${bdict[key]}`);
      }
      return lines.length ? lines.join("\n") : "(none)";
    }

    window.__dh = { parseSide, computeDeltaH, bondMap };
  </script>
</body>
</html>
